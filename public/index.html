<!DOCTYPE html>
<html>
<head>
	<title>Parking Monitoring App</title>
	<link rel="stylesheet" type="text/css" href="/stylesheets/index.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/particle-api-js/5/particle.min.js">
	</script>
</head>
<body>
	<h1>Parking Status for Capitol Hill Parking</h1>
	<table id="parkingtable">
	  <tr>
	    <th>Spot</th>
	    <th>Status</th>
	  </tr>
	  <tr>
	    <td>Spot 1</td>
	    <td id="spot_0">Vacant</td>
	  </tr>
	  <tr>
	    <td>Spot 2</td>
	    <td id="spot_1">Vacant</td>
	  </tr>
	  <tr>
	    <td>Spot 3</td>
	    <td  id="spot_2">Vacant</td>
	  </tr>
	</table>

	<br/>

	<div class="search_list">
		<select id="search_list">
			<option value="none">Choose a spot</option>
			<option value="spot_0">parking 0</option>
			<option value="spot_1">parking 1</option>
			<option value = "spot_2">parking 2</option>
		</select>
	</div>
	<div id="clicked-state"></div>
	<script type="text/javascript">

		/*(map.addListener("clickMapObject", function (event) {
		    $("#clicked-state").text(event.mapObject.title);
		    // TODO: display tweets from the selected state
		}); */

		// update the parking lot every 1 second
		//setInterval(function () {
		//    // TODO: Fill in callback function here
		//}, 1000);
		
		var socket = io();

		//var socket = io.connect("https://capstoneee475.firebaseapp.com/", {reconnect: true});
		socket.on("connect", function () {
			console.log("Connected!");
		});

		socket.on("receiveData", function(prev_values) { 
			console.log("INSIDE RECEIVE ON CLIENT");
			console.log(prev_values.term + " " + prev_values.occupied);
	    	//console.log(prev_values[i]);
	    	var occupied = "" + prev_values.occupied;
	    	var id = "#" + prev_values.term;
	        console.log("id: " + id);
	    	$(id).html(occupied);
		});
	
		socket.on("prev", function(prev_data) { 
	    	for (i in prev_data) {
	    		console.log("Previous data on the client side is: "+ prev_data);
	    		console.log(prev_data["key"]);
	    	}
		});

		socket.on("updateTable", function(status) { 
			console.log("INSIDE updateTable ON CLIENT");
	    	console.log("status: " + status.occupied);
	    	var occupied = "" + status.occupied;
	    	var id = "#" + status.term;
	        console.log("id: " + id);
	    	$(id).html("occupied");
	    	//document.getElementById(id).value = occupied;
		});

		$("#search_list").change(function() {
			// the search word change callback
			var str = "";
			$("select option:selected" ).each(function() {
				str = this.value;
			});
	    
	    
			if (str != "none") {
				var searchTerm = $(this).find('option:selected').text();
				//console.log(searchTerm);
				socket.emit("searchPhrase", str);
			} else {
				socket.emit("searchPhrase", "");
			}
		});

	</script>
</body>
</html>